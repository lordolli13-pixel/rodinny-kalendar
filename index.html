<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover" />
<title>Profi Family Kalend√°≈ô 2026</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a0f1a">
<style>
:root {
  --bg: #0a0f1a;
  --panel: rgba(255, 255, 255, 0.05);
  --border: rgba(255, 255, 255, 0.1);
  --gold: #d99a3f;
  --text: #ffffff;
  --muted: #9aa6b6;
  --clr-bday: #f59e0b;
  --clr-nameday: #10b981;
  --clr-anniv: #ec4899;
  font-family: 'Inter', system-ui, sans-serif;
}

body {
  margin:0; min-height: 100vh;
  background: radial-gradient(circle at top right, #1e293b, #0a0f1a);
  color: var(--text); padding: 10px; padding-top: env(safe-area-inset-top);
}

.wrap { max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; gap: 12px; }

.glass {
  background: var(--panel); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  border: 1px solid var(--border); border-radius: 18px;
}

/* Nov√° notifikaƒçn√≠ sekce */
.today-alert {
  padding: 15px; border-left: 4px solid var(--gold); background: linear-gradient(90deg, rgba(217, 154, 63, 0.15), transparent);
  display: none; animation: fadeIn 0.5s ease;
}
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

.header { padding: 15px; display: flex; flex-direction: column; gap: 12px; }
.brand { text-align: center; }
.brand .title { font-weight: 800; font-size: 20px; color: var(--gold); letter-spacing: 2px; }

.controls { display: flex; gap: 6px; flex-wrap: wrap; justify-content: center; }
.btn, .select {
  background: rgba(255,255,255,0.08); border: 1px solid var(--border);
  color: #fff; padding: 10px 12px; border-radius: 10px; cursor: pointer; font-size: 14px;
}
.btn-gold {
  background: var(--gold); color: #000; font-weight: bold; border: none;
  padding: 10px 16px; border-radius: 10px; cursor: pointer; font-size: 14px;
}

.filter-bar { padding: 10px 15px; display: flex; flex-direction: column; gap: 8px; }
.filter-title { font-size: 11px; font-weight: bold; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; }
.name-tags { display: flex; flex-wrap: wrap; gap: 6px; }
.tag-btn { 
  background: rgba(255,255,255,0.05); border: 1px solid var(--border); 
  color: var(--muted); padding: 5px 12px; border-radius: 20px; font-size: 12px; cursor: pointer; transition: 0.2s;
}
.tag-btn:hover { border-color: var(--gold); color: #fff; background: rgba(217,154,63,0.1); }

.main { display: grid; grid-template-columns: 1fr 320px; gap: 15px; }
@media(max-width: 900px) { .main { grid-template-columns: 1fr; } }

.detail { padding: 15px; }
.month-label { font-size: 22px; font-weight: 800; margin-bottom: 15px; color: #fff; display: flex; justify-content: space-between; align-items: center;}

.month-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
.weekday { font-size: 10px; color: var(--gold); text-align: center; font-weight: bold; padding: 5px 0; text-transform: uppercase; opacity: 0.7; }

.day {
  min-height: 90px; padding: 6px; border-radius: 12px;
  background: rgba(0,0,0,0.2); border: 1px solid var(--border);
  cursor: pointer; display: flex; flex-direction: column; gap: 4px; transition: transform 0.1s;
}
.day:active { transform: scale(0.96); }
.day.today { border-color: var(--gold); background: rgba(217, 154, 63, 0.12); box-shadow: 0 0 15px rgba(217,154,63,0.1); }
.day.weekend { background: rgba(255, 255, 255, 0.03); }
.day-num { font-weight: 900; font-size: 14px; }

.nameday-label { font-size: 9px; color: var(--muted); font-style: italic; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; height: 12px;}

.ev-tag {
  font-size: 10px; padding: 3px 6px; border-radius: 6px; color: #000;
  font-weight: 800; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  display: flex; align-items: center; gap: 3px;
}

.sidebar { display: flex; flex-direction: column; gap: 15px; }
.card { padding: 15px; }

.year-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
.mini { padding: 8px; border-radius: 12px; background: rgba(0,0,0,0.2); cursor: pointer; border: 1px solid transparent; }
.mini.selected { border-color: var(--gold); background: rgba(255,255,255,0.05); }
.mini-title { font-size: 11px; font-weight: bold; text-align: center; color: var(--gold); margin-bottom: 4px; }
.mini-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; font-size: 7px; text-align: center; color: #444; }

.modal-bg {
  position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px);
  display: none; align-items: center; justify-content: center; z-index: 1000; padding: 15px;
}
.modal-bg.show { display: flex; }
.modal { background: #161b26; padding: 25px; border-radius: 28px; width: 100%; max-width: 400px; border: 1px solid var(--gold); box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
.modal input, .modal select, .modal textarea {
  width: 100%; margin-bottom: 12px; padding: 14px; border-radius: 12px;
  background: #0a0f1a; border: 1px solid var(--border); color: #fff; font-size: 16px; outline: none;
}
.modal input:focus { border-color: var(--gold); }

.backup-btns { display: flex; gap: 10px; margin-top: 15px; }
.btn-small { font-size: 10px; padding: 5px 10px; opacity: 0.6; }
</style>
</head>
<body>

<div class="wrap">
  <div id="todayAlert" class="glass today-alert"></div>

  <header class="glass">
    <div class="header">
      <div class="brand"><div class="title">RODINN√ù KALEND√Å≈ò</div></div>
      <div class="controls">
        <button class="btn" id="prevMonth">‚óÄ</button>
        <select id="monthSelect" class="select"></select>
        <select id="yearSelect" class="select"></select>
        <button class="btn" id="nextMonth">‚ñ∂</button>
        <button class="btn-gold" id="todayBtn">DNES</button>
      </div>
    </div>
    <div class="filter-bar" style="border-top: 1px solid var(--border);">
      <div class="filter-title">Rychl√Ω p≈ôehled osob:</div>
      <div id="nameTags" class="name-tags"></div>
    </div>
  </header>

  <main class="main">
    <section class="detail glass">
      <div id="monthLabel" class="month-label">
        <span id="labelTxt">‚Äî</span>
      </div>
      <div class="month-grid" id="mainGrid"></div>
    </section>

    <aside class="sidebar">
      <div class="card glass">
        <div class="filter-title" style="margin-bottom:10px;">Roƒçn√≠ n√°hled</div>
        <div class="year-grid" id="yearGrid"></div>
        <div class="backup-btns">
            <button class="btn btn-small" onclick="exportData()">üíæ Export z√°lohy</button>
            <button class="btn btn-small" onclick="importData()">üìÇ Import</button>
        </div>
      </div>
    </aside>
  </main>
</div>

<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h3 id="modalTitle" style="color:var(--gold); margin-top:0; font-size: 20px;">Upravit den</h3>
    <div id="eventList" style="margin-bottom:20px; max-height:250px; overflow-y:auto; padding-right:5px;"></div>
    
    <div id="editForm" style="border-top:1px solid var(--border); padding-top:15px;">
      <input type="text" id="addName" placeholder="Jm√©no osoby...">
      <select id="addType">
        <option value="bday">üéÇ Narozeniny</option>
        <option value="nameday">üå∏ Sv√°tek (ruƒçnƒõ)</option>
        <option value="anniv">üíç V√Ωroƒç√≠ / Ud√°lost</option>
      </select>
      <input type="number" id="addYear" placeholder="Rok (nap≈ô. 1995)">
      <textarea id="addNote" rows="2" placeholder="Pozn√°mka, d√°rky..."></textarea>
      <button class="btn-gold" style="width:100%; padding:16px;" id="saveBtn">ULO≈ΩIT DO KALEND√Å≈òE</button>
    </div>
    
    <button onclick="closeModal()" style="width:100%; background:none; border:none; color:var(--muted); margin-top:20px; cursor:pointer; font-weight: bold;">ZAV≈ò√çT</button>
  </div>
</div>

<script>
// (Sv√°teƒçn√≠ datab√°ze z≈Øst√°v√° stejn√° jako v tv√©m k√≥du...)
const czNamedays = {"0-1":"Nov√Ω rok","0-2":"Karina","0-3":"Radmila","0-4":"Diana","0-5":"Dalimil","0-6":"T≈ôi kr√°lov√©","0-7":"Vilma","0-8":"ƒåestm√≠r","0-9":"Vladan","0-10":"B≈ôetislav","0-11":"Bohdana","0-12":"Pravoslav","0-13":"Edita","0-14":"Radovan","0-15":"Alice","0-16":"Ctirad","0-17":"Drahoslav","0-18":"Vladislav","0-19":"Doubravka","0-20":"Ilona","0-21":"Bƒõla","0-22":"Slavom√≠r","0-23":"Zdenƒõk","0-24":"Milena","0-25":"Milo≈°","0-26":"Zora","0-27":"Ingrid","0-28":"Ot√Ωlie","0-29":"Zdislava","0-30":"Robin","0-31":"Marika","1-1":"Hynek","1-2":"Nela","1-3":"Bla≈æej","1-4":"Jarmila","1-5":"Dobromila","1-6":"Vanda","1-7":"Veronika","1-8":"Milada","1-9":"Apolena","1-10":"Mojm√≠r","1-11":"Bo≈æena","1-12":"Slavƒõna","1-13":"Vƒõnceslav","1-14":"Valent√Ωn","1-15":"Ji≈ôina","1-16":"Ljuba","1-17":"Miloslava","1-18":"Gizela","1-19":"Patrik","1-20":"Old≈ôich","1-21":"Lenka","1-22":"Petr","1-23":"Svatopluk","1-24":"Matƒõj","1-25":"Liliana","1-26":"Dorota","1-27":"Alexandr","1-28":"Lum√≠r","1-29":"Horym√≠r","2-1":"Bed≈ôich","2-2":"Ane≈æka","2-3":"Kamil","2-4":"Stela","2-5":"Kazim√≠r","2-6":"Miroslav","2-7":"Tom√°≈°","2-8":"Gabriela","2-9":"Franti≈°ka","2-10":"Viktorie","2-11":"Andƒõla","2-12":"≈òeho≈ô","2-13":"R≈Ø≈æena","2-14":"R√∫t","2-15":"Ida","2-16":"Elena","2-17":"Vlastimil","2-18":"Eduard","2-19":"Josef","2-20":"Svƒõtlana","2-21":"Radek","2-22":"Leona","2-23":"Ivona","2-24":"Gabriel","2-25":"Mari√°n","2-26":"Emanuel","2-27":"Dita","2-28":"So≈àa","2-29":"Ta≈•√°na","2-30":"Arno≈°t","2-31":"Kvido","3-1":"Hugo","3-2":"Erika","3-3":"Richard","3-4":"Ivana","3-5":"Miroslava","3-6":"Vendula","3-7":"He≈ôman","3-8":"Ema","3-9":"Du≈°an","3-10":"Darja","3-11":"Izabela","3-12":"Julius","3-13":"Ale≈°","3-14":"Vincenc","3-15":"Anast√°zie","3-16":"Irena","3-17":"Rudolf","3-18":"Val√©rie","3-19":"Rostislav","3-20":"Marcela","3-21":"Alexandra","3-22":"Ev≈æenie","3-23":"Vojtƒõch","3-24":"Ji≈ô√≠","3-25":"Marek","3-26":"Ota","3-27":"Jaroslav","3-28":"Vlastislav","3-29":"Robert","3-30":"Blahoslav","4-1":"Sv√°tek pr√°ce","4-2":"Zikmund","4-3":"Alexej","4-4":"Kvƒõtoslav","4-5":"Klaudie","4-6":"Radoslav","4-7":"Stanislav","4-8":"Den v√≠tƒõzstv√≠","4-9":"Ctibor","4-10":"Bla≈æena","4-11":"Svatava","4-12":"Pankr√°c","4-13":"Serv√°c","4-14":"Bonif√°c","4-15":"≈Ωofie","4-16":"P≈ôemysl","4-17":"Aneta","4-18":"Nata≈°a","4-19":"Ivo","4-20":"Zby≈°ek","4-21":"Monika","4-22":"Emil","4-23":"Vladim√≠r","4-24":"Jana","4-25":"Viola","4-26":"Filip","4-27":"Valdemar","4-28":"Vil√©m","4-29":"Maxmili√°n","4-30":"Ferdinand","5-1":"Laura","5-2":"Jarmil","5-3":"Tamara","5-4":"Dalibor","5-5":"Dobroslav","5-6":"Norbert","5-7":"Iveta","5-8":"Medard","5-9":"Stanislava","5-10":"Gita","5-11":"Bruno","5-12":"Antonie","5-13":"Anton√≠n","5-14":"Roland","5-15":"V√≠t","5-16":"Zbynƒõk","5-17":"Adolf","5-18":"Milan","5-19":"Leo≈°","5-20":"Kvƒõta","5-21":"Alois","5-22":"Pavla","5-23":"Zde≈àka","5-24":"Jan","5-25":"Ivan","5-26":"Adriana","5-27":"Ladislav","5-28":"Lubom√≠r","5-29":"Petr a Pavel","5-30":"≈†√°rka","6-1":"Jaroslava","6-2":"Patricie","6-3":"Radom√≠r","6-4":"Prokop","6-5":"Cyril a Metodƒõj","6-6":"Mistr Jan Hus","6-7":"Bohuslava","6-8":"Nora","6-9":"Drahoslava","6-10":"Libu≈°e","6-11":"Olga","6-12":"Bo≈ôek","6-13":"Mark√©ta","6-14":"Karol√≠na","6-15":"Jind≈ôich","6-16":"Lubo≈°","6-17":"Martina","6-18":"Drahom√≠ra","6-19":"ƒåenƒõk","6-20":"Ilja","6-21":"V√≠tƒõzslav","6-22":"Magdal√©na","6-23":"Libor","6-24":"Krist√Ωna","6-25":"Jakub","6-26":"Anna","6-27":"Alena","6-28":"Viktor","6-29":"Marta","6-30":"Bo≈ôivoj","7-1":"Oskar","7-2":"Gustav","7-3":"Milu≈°e","7-4":"Dominik","7-5":"Kristi√°n","7-6":"Old≈ôi≈°ka","7-7":"Lada","7-8":"Sobƒõslav","7-9":"Roman","7-10":"Vav≈ôinec","7-11":"Zuzana","7-12":"Kl√°ra","7-13":"Alena","7-14":"Alan","7-15":"Hana","7-16":"J√°chym","7-17":"Petra","7-18":"Helena","7-19":"Ludv√≠k","7-20":"Bernard","7-21":"Johana","7-22":"Bohuslav","7-23":"Sandra","7-24":"Bartolomƒõj","7-25":"Radim","7-26":"Ludƒõk","7-27":"Otakar","7-28":"August√Ωn","7-29":"Evel√≠na","7-30":"Vladƒõna","7-31":"Pavl√≠na","8-1":"Linda","8-2":"Ad√©la","8-3":"Bronislav","8-4":"Jind≈ôi≈°ka","8-5":"Boris","8-6":"Boleslav","8-7":"Reg√≠na","8-8":"Mariana","8-9":"Daniela","8-10":"Irma","8-11":"Denisa","8-12":"Marie","8-13":"Lubor","8-14":"Radka","8-15":"Jolana","8-16":"Ludmila","8-17":"Nadƒõ≈æda","8-18":"Kry≈°tof","8-19":"Zita","8-20":"Oleg","8-21":"Matou≈°","8-22":"Darina","8-23":"Berta","8-24":"Jarom√≠r","8-25":"Zlata","8-26":"Andrea","8-27":"Jon√°≈°","8-28":"V√°clav","8-29":"Michal","8-30":"Jeron√Ωm","9-1":"Igor","9-2":"Ol√≠vie","9-3":"Bohumil","9-4":"Franti≈°ek","9-5":"Eli≈°ka","9-6":"Hanu≈°","9-7":"Just√Ωna","9-8":"Vƒõra","9-9":"≈†tefan","9-10":"Marina","9-11":"Andrej","9-12":"Marcel","9-13":"Ren√°ta","9-14":"Ag√°ta","9-15":"Tereza","9-16":"Havel","9-17":"Hedvika","9-18":"Luk√°≈°","9-19":"Michaela","9-20":"Vendel√≠n","9-21":"Brigita","9-22":"Sabina","9-23":"Teodor","9-24":"Nina","9-25":"Be√°ta","9-26":"Erik","9-27":"≈†arlota","9-28":"St√°tn√≠ sv√°tek","9-29":"Silvie","9-30":"Tade√°≈°","10-1":"Felix","10-2":"Pam√°tka zesnul√Ωch","10-3":"Hubert","10-4":"Karel","10-5":"Miriam","10-6":"Libƒõna","10-7":"Saskie","10-8":"Bohum√≠r","10-9":"Bohdan","10-10":"Marina","10-11":"Martin","10-12":"Benedikt","10-13":"Tibor","10-14":"S√°va","10-15":"Leopold","10-16":"Otmar","10-17":"Mahulena","10-18":"Romana","10-19":"Al≈æbƒõta","10-20":"Nikola","10-21":"Albert","10-22":"Cec√≠lie","10-23":"Klement","10-24":"Em√≠lie","10-25":"Kate≈ôina","10-26":"Artur","10-27":"Xenie","10-28":"Den vzniku ƒåR","10-29":"Zina","10-30":"Ond≈ôej","11-1":"Iva","11-2":"Blanka","11-3":"Svatoslav","11-4":"Barbora","11-5":"Jitka","11-6":"Mikul√°≈°","11-7":"Ambro≈æ","11-8":"Kvƒõtoslava","11-9":"Vratislav","11-10":"Julie","11-11":"Dana","11-12":"Simona","11-13":"Lucie","11-14":"L√Ωdie","11-15":"Radana","11-16":"Alb√≠na","11-17":"Daniel","11-18":"Miloslav","11-19":"Ester","11-20":"Dagmar","11-21":"Nat√°lie","11-22":"≈†imon","11-23":"Vlasta","11-24":"Adam a Eva","11-25":"Bo≈æ√≠ hod","11-26":"≈†tƒõp√°n","11-27":"≈Ωaneta","11-28":"Bohumila","11-29":"Judita","11-30":"David","11-31":"Silvestr"};

const months = ["Leden","√önor","B≈ôezen","Duben","Kvƒõten","ƒåerven","ƒåervenec","Srpen","Z√°≈ô√≠","≈ò√≠jen","Listopad","Prosinec"];
const cats = { bday: { c: 'var(--clr-bday)', i: 'üéÇ' }, nameday: { c: 'var(--clr-nameday)', i: 'üå∏' }, anniv: { c: 'var(--clr-anniv)', i: 'üíç' } };
let curYear = 2026, curMonth = new Date().getMonth(), events = JSON.parse(localStorage.getItem('family_cal_v8') || '{}'), editDateKey = null;

function init() {
  months.forEach((m,i) => document.getElementById('monthSelect').innerHTML += `<option value="${i}">${m}</option>`);
  for(let y=2024; y<=2035; y++) document.getElementById('yearSelect').innerHTML += `<option value="${y}">${y}</option>`;
  
  document.getElementById('prevMonth').onclick = () => { curMonth--; if(curMonth<0){curMonth=11; curYear--;} render(); };
  document.getElementById('nextMonth').onclick = () => { curMonth++; if(curMonth>11){curMonth=0; curYear++;} render(); };
  document.getElementById('monthSelect').onchange = (e) => { curMonth = parseInt(e.target.value); render(); };
  document.getElementById('yearSelect').onchange = (e) => { curYear = parseInt(e.target.value); render(); };
  document.getElementById('todayBtn').onclick = () => { const n=new Date(); curYear=n.getFullYear(); curMonth=n.getMonth(); render(); };
  
  // ≈Ω√°dost o notifikace
  if ("Notification" in window && Notification.permission === "default") {
    Notification.requestPermission();
  }

  render();
  checkTodayAlerts();
}

// Funkce pro dne≈°n√≠ p≈ôehled
function checkTodayAlerts() {
  const now = new Date();
  const d = now.getDate();
  const m = now.getMonth();
  const key = `${m}-${d}`;
  const alertBox = document.getElementById('todayAlert');
  const familyEvs = events[key] || [];
  const svatek = czNamedays[key];

  let html = `<div style="font-weight:bold; color:var(--gold); margin-bottom:5px; font-size:13px;">DNES ${d}. ${months[m]}</div>`;
  html += `<div style="font-size:15px;">üå∏ Sv√°tek: <b>${svatek || '---'}</b></div>`;

  familyEvs.forEach(ev => {
    const age = ev.y ? ` (${curYear - ev.y}. v√Ωroƒç√≠)` : "";
    html += `<div style="margin-top:5px; font-size:15px;">${cats[ev.type].i} <b>${ev.n}</b>${age}</div>`;
    // Syst√©mov√° notifikace
    if (Notification.permission === "granted") {
        new Notification("Rodinn√Ω Kalend√°≈ô", { body: `Dnes: ${ev.n} m√° ${ev.type === 'bday' ? 'narozeniny' : 'ud√°lost'}!` });
    }
  });

  alertBox.innerHTML = html;
  alertBox.style.display = "block";
}

function closeModal() { document.getElementById('modalBg').classList.remove('show'); }

function openEdit(m, d) {
  editDateKey = `${m}-${d}`;
  const holiday = czNamedays[editDateKey] ? ` - ${czNamedays[editDateKey]}` : "";
  document.getElementById('modalTitle').innerText = `${d}. ${months[m]}${holiday}`;
  document.getElementById('editForm').style.display = "block";
  const list = document.getElementById('eventList'); list.innerHTML = "";
  
  (events[editDateKey] || []).forEach((ev, i) => {
    const age = (ev.y) ? ` (${curYear - ev.y} let)` : "";
    list.innerHTML += `<div style="background:${cats[ev.type].c}; color:#000; padding:12px; border-radius:14px; margin-bottom:10px; font-weight:bold; font-size:14px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <span>${cats[ev.type].i} ${ev.n}${age}</span>
        <span onclick="event.stopPropagation(); delEv('${editDateKey}',${i})" style="cursor:pointer; background:rgba(0,0,0,0.1); width:24px; height:24px; display:flex; align-items:center; justify-content:center; border-radius:50%;">‚úï</span>
      </div>
      ${ev.note ? `<div style="font-weight:normal; font-size:12px; border-top:1px solid rgba(0,0,0,0.1); margin-top:6px; padding-top:6px; opacity:0.8;">${ev.note}</div>` : ''}
    </div>`;
  });
  document.getElementById('modalBg').classList.add('show');
}

function openPersonFilter(name) {
  document.getElementById('modalTitle').innerText = `Osoba: ${name}`;
  document.getElementById('editForm').style.display = "none";
  const list = document.getElementById('eventList'); list.innerHTML = "";
  
  let found = [];
  for (let key in events) {
    events[key].forEach(ev => {
      if(ev.n === name) {
        const [m, d] = key.split('-');
        found.push({ m: parseInt(m), d: parseInt(d), ...ev });
      }
    });
  }
  found.sort((a,b) => a.m - b.m || a.d - b.d);
  
  if(found.length === 0) list.innerHTML = "<div style='text-align:center; padding:20px; opacity:0.5;'>≈Ω√°dn√© z√°znamy.</div>";
  found.forEach(ev => {
    const age = (ev.y) ? ` (${curYear - ev.y} let)` : "";
    list.innerHTML += `<div style="border-left:4px solid ${cats[ev.type].c}; background:rgba(255,255,255,0.05); padding:12px; border-radius:12px; margin-bottom:12px;">
      <div style="font-size:11px; color:var(--gold); font-weight:bold; margin-bottom:4px;">${ev.d}. ${months[ev.m]}</div>
      <div style="font-size:15px; font-weight:bold;">${cats[ev.type].i} ${ev.type==='bday'?'Narozeniny':'Ud√°lost'}${age}</div>
      ${ev.note ? `<div style="font-size:13px; color:var(--muted); margin-top:6px; line-height:1.4;">${ev.note}</div>` : ''}
    </div>`;
  });
  document.getElementById('modalBg').classList.add('show');
}

function delEv(key, i) { 
  if(!confirm("Opravdu smazat?")) return;
  events[key].splice(i,1); 
  if(!events[key].length) delete events[key]; 
  localStorage.setItem('family_cal_v8', JSON.stringify(events)); 
  openEdit(...key.split('-')); render(); 
}

document.getElementById('saveBtn').onclick = () => {
  const n = document.getElementById('addName').value.trim();
  if(!n) return;
  if(!events[editDateKey]) events[editDateKey] = [];
  events[editDateKey].push({ 
    n, 
    type: document.getElementById('addType').value, 
    y: document.getElementById('addYear').value ? parseInt(document.getElementById('addYear').value) : null, 
    note: document.getElementById('addNote').value.trim() 
  });
  localStorage.setItem('family_cal_v8', JSON.stringify(events));
  document.getElementById('addName').value = ""; document.getElementById('addYear').value = ""; document.getElementById('addNote').value = "";
  openEdit(...editDateKey.split('-')); render();
};

function exportData() {
    const data = JSON.stringify(events);
    const blob = new Blob([data], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `kalendar_zaloha_${new Date().getFullYear()}.json`;
    a.click();
}

function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = readerEvent => {
            try {
                const content = JSON.parse(readerEvent.target.result);
                if(confirm("T√≠mto p≈ôep√≠≈°ete st√°vaj√≠c√≠ kalend√°≈ô. Pokraƒçovat?")) {
                    events = content;
                    localStorage.setItem('family_cal_v8', JSON.stringify(events));
                    render();
                }
            } catch(e) { alert("Chyba souboru!"); }
        }
        reader.readAsText(file);
    }
    input.click();
}

function render() {
  document.getElementById('monthSelect').value = curMonth;
  document.getElementById('yearSelect').value = curYear;
  document.getElementById('labelTxt').innerText = `${months[curMonth].toUpperCase()} ${curYear}`;
  
  const grid = document.getElementById('mainGrid'); grid.innerHTML = "";
  ["Po","√öt","St","ƒåt","P√°","So","Ne"].forEach(w => grid.innerHTML += `<div class="weekday">${w}</div>`);
  
  const first = (new Date(curYear, curMonth, 1).getDay() || 7) - 1, days = new Date(curYear, curMonth + 1, 0).getDate();
  for(let i=0; i<first; i++) grid.innerHTML += `<div class="day empty" style="border:none; background:none;"></div>`;
  
  const names = new Set();
  for(let d=1; d<=days; d++) {
    const k = `${curMonth}-${d}`, evs = events[k] || [];
    const dateObj = new Date(curYear, curMonth, d);
    const isToday = (d===new Date().getDate() && curMonth===new Date().getMonth() && curYear===new Date().getFullYear());
    const isWeekend = (dateObj.getDay() === 0 || dateObj.getDay() === 6);
    const nameday = czNamedays[k] || "";
    
    let h = ""; 
    evs.forEach(e => {
      const ageDisplay = (e.type==='bday' && e.y) ? ` ${curYear - e.y}` : "";
      h += `<div class="ev-tag" style="background:${cats[e.type].c}">${cats[e.type].i} ${e.n.substring(0,8)}${ageDisplay}</div>`;
    });
    
    grid.innerHTML += `
      <div class="day ${isToday?'today':''} ${isWeekend?'weekend':''}" onclick="openEdit(${curMonth},${d})">
        <div class="day-num">${d}</div>
        <div class="nameday-label">${nameday}</div>
        <div style="flex-grow:1">${h}</div>
      </div>`;
  }

  for(let k in events) events[k].forEach(e => names.add(e.n));
  const nt = document.getElementById('nameTags'); nt.innerHTML = "";
  Array.from(names).sort().forEach(n => {
    const btn = document.createElement('button');
    btn.className = `tag-btn`;
    btn.innerText = n;
    btn.onclick = (e) => { e.stopPropagation(); openPersonFilter(n); };
    nt.appendChild(btn);
  });

  const yg = document.getElementById('yearGrid'); yg.innerHTML = "";
  for(let m=0; m<12; m++) {
    let mg = ""; const md = new Date(curYear, m+1, 0).getDate(), mf = (new Date(curYear, m, 1).getDay() || 7) - 1;
    for(let i=0; i<mf; i++) mg += `<div></div>`;
    for(let d=1; d<=md; d++) {
      const hasEv = events[`${m}-${d}`];
      mg += `<div style="color:${hasEv ? cats[hasEv[0].type].c : ''}; font-weight:${hasEv?'bold':'normal'}">${d}</div>`;
    }
    yg.innerHTML += `<div class="mini ${m===curMonth?'selected':''}" onclick="curMonth=${m}; render();"><div class="mini-title">${months[m]}</div><div class="mini-days">${mg}</div></div>`;
  }
}

// Spu≈°tƒõn√≠
init();
</script>
</body>
</html>
