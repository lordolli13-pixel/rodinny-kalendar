<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Rodinn√Ω Kalend√°≈ô 2026</title>
    <style>
        :root {
            --bg: #0a0f1a;
            --panel: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --gold: #d99a3f;
            --text: #ffffff;
            --muted: #9aa6b6;
            --clr-bday: #f59e0b;
            --clr-nameday: #10b981;
            --clr-anniv: #ec4899;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }

        body {
            margin: 0; min-height: 100vh;
            background: radial-gradient(circle at top right, #1e293b, #0a0f1a);
            color: var(--text); padding: 10px;
            -webkit-tap-highlight-color: transparent;
        }

        .wrap { max-width: 1200px; margin: 0 auto; display: flex; flex-direction: column; gap: 12px; }

        .glass {
            background: var(--panel); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border); border-radius: 20px;
        }

        /* HEADER */
        .header { padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        .brand .title { font-weight: 800; font-size: 18px; color: var(--gold); text-align: center; letter-spacing: 2px; }

        .controls { display: flex; gap: 6px; justify-content: center; flex-wrap: wrap; }
        .btn, .select {
            background: rgba(255,255,255,0.08); border: 1px solid var(--border);
            color: #fff; padding: 10px; border-radius: 12px; cursor: pointer; font-size: 14px;
        }
        .btn-gold {
            background: var(--gold); color: #000; font-weight: bold; border: none;
            padding: 10px 18px; border-radius: 12px; cursor: pointer; font-size: 14px;
        }

        /* PEOPLE SECTION */
        .filter-bar { padding: 15px; border-top: 1px solid var(--border); }
        .filter-title { font-size: 11px; font-weight: bold; color: var(--gold); text-transform: uppercase; margin-bottom: 12px; opacity: 0.8; }
        
        .name-tags { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
        .person-card {
            background: rgba(255,255,255,0.05); border: 1px solid var(--border);
            padding: 10px; border-radius: 14px; display: flex; flex-direction: column;
            align-items: center; gap: 5px; cursor: pointer; transition: 0.2s;
        }
        .person-card:hover { border-color: var(--gold); background: rgba(255,255,255,0.1); }
        .person-card .avatar { font-size: 20px; }
        .person-card .name { font-size: 12px; font-weight: bold; color: #fff; text-align: center; }

        /* MAIN GRID */
        .main { display: grid; grid-template-columns: 1fr 320px; gap: 15px; }
        @media(max-width: 900px) { .main { grid-template-columns: 1fr; } }

        .detail { padding: 15px; }
        .month-label { font-size: 20px; font-weight: 800; margin-bottom: 15px; color: #fff; text-align: center; }

        .month-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .weekday { font-size: 10px; color: var(--gold); text-align: center; font-weight: bold; padding-bottom: 8px; }

        .day {
            min-height: 80px; padding: 6px; border-radius: 12px;
            background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            cursor: pointer; display: flex; flex-direction: column; gap: 3px;
        }
        .day.today { border-color: var(--gold); background: rgba(217, 154, 63, 0.1); }
        .day.weekend { background: rgba(255, 255, 255, 0.03); }
        .day-num { font-weight: bold; font-size: 13px; }
        .nameday-label { font-size: 8px; color: var(--muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .ev-tag {
            font-size: 9px; padding: 2px 5px; border-radius: 5px; color: #000;
            font-weight: 800; overflow: hidden; text-overflow: ellipsis; display: flex; align-items: center; gap: 3px;
        }

        /* MODAL */
        .modal-bg {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            display: none; align-items: center; justify-content: center; z-index: 1000; padding: 15px;
        }
        .modal-bg.show { display: flex; }
        .modal { 
            background: #161b26; padding: 25px; border-radius: 28px; width: 100%; 
            max-width: 420px; border: 1px solid var(--gold); max-height: 85vh; overflow-y: auto;
        }
        .modal input, .modal select, .modal textarea {
            width: 100%; margin-bottom: 12px; padding: 14px; border-radius: 12px;
            background: #0a0f1a; border: 1px solid var(--border); color: #fff; font-size: 16px; box-sizing: border-box;
        }

        /* SIDEBAR YEAR */
        .year-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .mini { padding: 10px; border-radius: 15px; background: rgba(0,0,0,0.2); cursor: pointer; }
        .mini.selected { border-color: var(--gold); border: 1px solid var(--gold); }
        .mini-title { font-size: 11px; font-weight: bold; text-align: center; color: var(--gold); margin-bottom: 5px; }
        .mini-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; font-size: 7px; text-align: center; color: #444; }

        /* SEARCH RESULT ITEM */
        .res-item {
            background: rgba(255,255,255,0.05); border-left: 4px solid var(--gold);
            padding: 12px; border-radius: 10px; margin-bottom: 10px;
        }
        .res-date { font-size: 10px; color: var(--gold); font-weight: bold; margin-bottom: 3px; }
        .res-info { font-size: 14px; font-weight: bold; }
    </style>
</head>
<body>

<div class="wrap">
    <header class="glass">
        <div class="header">
            <div class="brand"><div class="title">FAMILY CALENDAR</div></div>
            <div class="controls">
                <button class="btn" id="prevMonth">‚óÄ</button>
                <select id="monthSelect" class="select"></select>
                <select id="yearSelect" class="select"></select>
                <button class="btn" id="nextMonth">‚ñ∂</button>
                <button class="btn-gold" id="todayBtn">DNES</button>
            </div>
        </div>
        <div class="filter-bar">
            <div class="filter-title">Rodina a p≈ô√°tel√©</div>
            <div id="nameTags" class="name-tags"></div>
        </div>
    </header>

    <main class="main">
        <section class="detail glass">
            <div id="monthLabel" class="month-label">‚Äî</div>
            <div class="month-grid" id="mainGrid"></div>
        </section>

        <aside class="sidebar">
            <div class="card glass">
                <div class="filter-title">Roƒçn√≠ p≈ôehled</div>
                <div class="year-grid" id="yearGrid"></div>
            </div>
        </aside>
    </main>
</div>

<div class="modal-bg" id="modalBg">
    <div class="modal">
        <h3 id="modalTitle" style="color:var(--gold); margin-top:0; margin-bottom:20px;">Detail</h3>
        <div id="modalContent"></div>
        
        <div id="editForm" style="border-top:1px solid var(--border); padding-top:20px; margin-top:10px;">
            <input type="text" id="addName" placeholder="Jm√©no osoby">
            <select id="addType">
                <option value="bday">üéÇ Narozeniny</option>
                <option value="nameday">üå∏ Sv√°tek</option>
                <option value="anniv">üíç V√Ωroƒç√≠</option>
            </select>
            <input type="number" id="addYear" placeholder="Rok zaƒç√°tku (nap≈ô. 1995)">
            <textarea id="addNote" placeholder="Pozn√°mka..."></textarea>
            <button class="btn-gold" style="width:100%" id="saveBtn">ULO≈ΩIT DO KALEND√Å≈òE</button>
        </div>
        
        <button onclick="closeModal()" style="width:100%; background:none; border:none; color:var(--muted); margin-top:20px; cursor:pointer; font-weight:bold; font-size:14px;">ZAV≈ò√çT</button>
    </div>
</div>

<script>
const czNamedays = {"0-1":"Nov√Ω rok","0-2":"Karina","0-3":"Radmila","0-4":"Diana","0-5":"Dalimil","0-6":"T≈ôi kr√°lov√©","0-24":"Milena","0-27":"Ingrid","1-14":"Valent√Ωn","1-24":"Matƒõj","2-19":"Josef","3-24":"Ji≈ô√≠","4-1":"Sv√°tek pr√°ce","4-8":"Den v√≠tƒõzstv√≠","4-24":"Jana","5-24":"Jan","6-5":"Cyril a Metodƒõj","6-6":"Mistr Jan Hus","9-28":"V√°clav","10-28":"Vznik ƒåSR","11-24":"Adam a Eva","11-25":"V√°noce","11-26":"≈†tƒõp√°n"};

const months = ["Leden","√önor","B≈ôezen","Duben","Kvƒõten","ƒåerven","ƒåervenec","Srpen","Z√°≈ô√≠","≈ò√≠jen","Listopad","Prosinec"];
const cats = { bday: { c: 'var(--clr-bday)', i: 'üéÇ' }, nameday: { c: 'var(--clr-nameday)', i: 'üå∏' }, anniv: { c: 'var(--clr-anniv)', i: 'üíç' } };
let curYear = 2026, curMonth = new Date().getMonth(), events = JSON.parse(localStorage.getItem('family_cal_v9') || '{}'), editDateKey = null;

function init() {
    const ms = document.getElementById('monthSelect');
    const ys = document.getElementById('yearSelect');
    months.forEach((m,i) => ms.innerHTML += `<option value="${i}">${m}</option>`);
    for(let y=2024; y<=2035; y++) ys.innerHTML += `<option value="${y}">${y}</option>`;
    
    document.getElementById('prevMonth').onclick = () => { curMonth--; if(curMonth<0){curMonth=11; curYear--;} render(); };
    document.getElementById('nextMonth').onclick = () => { curMonth++; if(curMonth>11){curMonth=0; curYear++;} render(); };
    ms.onchange = (e) => { curMonth = parseInt(e.target.value); render(); };
    ys.onchange = (e) => { curYear = parseInt(e.target.value); render(); };
    document.getElementById('todayBtn').onclick = () => { const n=new Date(); curYear=n.getFullYear(); curMonth=n.getMonth(); render(); };
    
    render();
}

function closeModal() { document.getElementById('modalBg').classList.remove('show'); }

// 1. Otev≈ôen√≠ detailu dne (p≈ôid√°v√°n√≠ ud√°lost√≠)
function openDayDetail(m, d) {
    editDateKey = `${m}-${d}`;
    document.getElementById('modalTitle').innerText = `${d}. ${months[m]} ${curYear}`;
    document.getElementById('editForm').style.display = "block";
    const container = document.getElementById('modalContent');
    container.innerHTML = "";
    
    const evs = events[editDateKey] || [];
    evs.forEach((ev, i) => {
        const age = (ev.type==='bday' && ev.y) ? ` (${curYear - ev.y} let)` : "";
        container.innerHTML += `
            <div style="background:${cats[ev.type].c}; color:#000; padding:12px; border-radius:12px; margin-bottom:8px; font-weight:bold; display:flex; justify-content:space-between; align-items:center;">
                <span>${cats[ev.type].i} ${ev.n}${age}</span>
                <span onclick="delEv('${editDateKey}',${i})" style="cursor:pointer; font-size:18px;">‚úï</span>
            </div>`;
    });
    document.getElementById('modalBg').classList.add('show');
}

// 2. Otev≈ôen√≠ detailu OSOBY (v≈°echny jej√≠ ud√°losti)
function openPersonDetail(name) {
    document.getElementById('modalTitle').innerText = `Profil: ${name}`;
    document.getElementById('editForm').style.display = "none";
    const container = document.getElementById('modalContent');
    container.innerHTML = "";

    let found = [];
    for (let key in events) {
        events[key].forEach(ev => {
            if(ev.n.toLowerCase() === name.toLowerCase()) {
                const [m, d] = key.split('-');
                found.push({ m: parseInt(m), d: parseInt(d), ...ev });
            }
        });
    }

    found.sort((a,b) => a.m - b.m || a.d - b.d);

    if(found.length === 0) container.innerHTML = "<p style='color:var(--muted)'>≈Ω√°dn√© ud√°losti pro tuto osobu.</p>";
    
    found.forEach(ev => {
        const age = (ev.type==='bday' && ev.y) ? ` (${curYear - ev.y} let)` : "";
        container.innerHTML += `
            <div class="res-item">
                <div class="res-date">${ev.d}. ${months[ev.m]}</div>
                <div class="res-info">${cats[ev.type].i} ${ev.type==='bday'?'Narozeniny':ev.type==='nameday'?'Sv√°tek':'V√Ωroƒç√≠'}${age}</div>
                ${ev.note ? `<div style="font-size:12px; color:var(--muted); margin-top:5px;">${ev.note}</div>` : ''}
            </div>`;
    });

    document.getElementById('modalBg').classList.add('show');
}

function delEv(key, i) {
    events[key].splice(i,1);
    if(!events[key].length) delete events[key];
    localStorage.setItem('family_cal_v9', JSON.stringify(events));
    openDayDetail(...key.split('-')); render();
}

document.getElementById('saveBtn').onclick = () => {
    const n = document.getElementById('addName').value.trim();
    if(!n) return;
    if(!events[editDateKey]) events[editDateKey] = [];
    events[editDateKey].push({ 
        n, type: document.getElementById('addType').value, 
        y: parseInt(document.getElementById('addYear').value) || null, 
        note: document.getElementById('addNote').value 
    });
    localStorage.setItem('family_cal_v9', JSON.stringify(events));
    document.getElementById('addName').value = ""; document.getElementById('addYear').value = ""; document.getElementById('addNote').value = "";
    openDayDetail(...editDateKey.split('-')); render();
};

function render() {
    document.getElementById('monthSelect').value = curMonth;
    document.getElementById('yearSelect').value = curYear;
    document.getElementById('monthLabel').innerText = `${months[curMonth].toUpperCase()} ${curYear}`;
    
    const grid = document.getElementById('mainGrid'); grid.innerHTML = "";
    ["Po","√öt","St","ƒåt","P√°","So","Ne"].forEach(w => grid.innerHTML += `<div class="weekday">${w}</div>`);
    
    const first = (new Date(curYear, curMonth, 1).getDay() || 7) - 1;
    const days = new Date(curYear, curMonth + 1, 0).getDate();
    for(let i=0; i<first; i++) grid.innerHTML += `<div></div>`;
    
    const names = new Set();
    for(let d=1; d<=days; d++) {
        const k = `${curMonth}-${d}`, evs = events[k] || [];
        const isToday = (d===new Date().getDate() && curMonth===new Date().getMonth() && curYear===new Date().getFullYear());
        const isWeekend = (new Date(curYear, curMonth, d).getDay() % 6 === 0);
        
        let tags = ""; 
        evs.forEach(e => {
            tags += `<div class="ev-tag" style="background:${cats[e.type].c}">${cats[e.type].i} ${e.n.substring(0,6)}</div>`;
        });
        
        grid.innerHTML += `
            <div class="day ${isToday?'today':''} ${isWeekend?'weekend':''}" onclick="openDayDetail(${curMonth},${d})">
                <div class="day-num">${d}</div>
                <div class="nameday-label">${czNamedays[k] || ""}</div>
                ${tags}
            </div>`;
    }

    // PERSON CARDS
    for(let k in events) events[k].forEach(e => names.add(e.n));
    const nt = document.getElementById('nameTags'); nt.innerHTML = "";
    Array.from(names).sort().forEach(n => {
        const card = document.createElement('div');
        card.className = 'person-card';
        card.innerHTML = `<div class="avatar">üë§</div><div class="name">${n}</div>`;
        card.onclick = () => openPersonDetail(n);
        nt.appendChild(card);
    });

    // MINI YEAR VIEW
    const yg = document.getElementById('yearGrid'); yg.innerHTML = "";
    for(let m=0; m<12; m++) {
        let mg = ""; 
        const md = new Date(curYear, m+1, 0).getDate();
        const mf = (new Date(curYear, m, 1).getDay() || 7) - 1;
        for(let i=0; i<mf; i++) mg += `<div></div>`;
        for(let d=1; d<=md; d++) {
            const hasEv = events[`${m}-${d}`];
            mg += `<div style="${hasEv ? 'color:white; background:'+cats[hasEv[0].type].c+'; border-radius:2px;' : ''}">${d}</div>`;
        }
        yg.innerHTML += `<div class="mini ${m===curMonth?'selected':''}" onclick="curMonth=${m}; render();"><div class="mini-title">${months[m]}</div><div class="mini-days">${mg}</div></div>`;
    }
}
init();
</script>
</body>
</html>
