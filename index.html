<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<title>Family Calendar Slate Pro</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2F4F4F">
<link rel="apple-touch-icon" href="icon.png">
<style>
:root {
  --bg: #2F4F4F; --panel: #263f3f; --border: #1c2e2e; --gold: #fef5e7; --text: #fef5e7;       
  --muted: #a3b8b8; --clr-bday: #ffab40; --clr-nameday: #98ee99; --clr-anniv: #ff80ab;  
  --day-bg: #365a5a; --header-bg: rgba(47, 79, 79, 0.98);
  font-family: 'Inter', -apple-system, sans-serif;
}
[data-theme="light"] {
  --bg: #e8e2d2; --panel: #dbd4c3; --border: #c4bcab; --gold: #8d6228; --text: #1a1917;
  --muted: #5c5850; --day-bg: #f2ede0; --header-bg: rgba(232, 226, 210, 0.98);
}
body { margin:0; min-height: 100vh; background: var(--bg); color: var(--text); padding-bottom: 80px; transition: background 0.4s; font-size: 18px; }
header { position: sticky; top: 0; z-index: 100; background: var(--header-bg); backdrop-filter: blur(15px); border-bottom: 2px solid var(--border); padding: 16px; }
.brand { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
.brand .title { font-weight: 900; font-size: 22px; color: var(--gold); letter-spacing: 1.5px; }
.theme-toggle { background: var(--panel); border: 1.5px solid var(--border); color: var(--text); padding: 10px 15px; border-radius: 12px; cursor: pointer; font-size: 22px; }
.view-switch { display: flex; background: var(--panel); border-radius: 16px; padding: 5px; margin-bottom: 15px; border: 1.5px solid var(--border); }
.view-switch button { flex: 1; border: none; background: transparent; color: var(--muted); padding: 14px; border-radius: 12px; font-weight: 800; font-size: 16px; cursor: pointer; }
.view-switch button.active { background: var(--gold); color: #1c2e2e; }
.person-search { display: flex; gap: 12px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
.person-box { background: var(--panel); border: 2px solid var(--gold); color: var(--gold); padding: 10px 22px; border-radius: 25px; white-space: nowrap; font-size: 16px; font-weight: 800; cursor: pointer; }
.controls { display: flex; gap: 10px; margin-top: 10px; }
.select { background: var(--panel); border: 2px solid var(--border); color: var(--text); padding: 14px; border-radius: 14px; flex: 1; font-size: 18px; font-weight: bold; appearance: none; }
.btn-nav { background: var(--panel); border: 2px solid var(--border); color: var(--text); padding: 12px 22px; border-radius: 14px; font-weight: 900; font-size: 18px; cursor: pointer; }
.main-content { padding: 16px; }
.view-section { display: none; }
.view-section.active { display: block; }
.agenda-title { font-size: 14px; font-weight: 900; color: var(--gold); text-transform: uppercase; margin-bottom: 12px; letter-spacing: 1.5px; }
.ev-row { background: var(--panel); padding: 16px; border-radius: 18px; margin-bottom: 12px; display: flex; align-items: center; gap: 15px; border: 1.5px solid var(--border); border-left: 8px solid transparent; font-size: 18px; font-weight: 600; }
.month-label { font-size: 32px; font-weight: 900; margin-bottom: 20px; color: var(--gold); }
.month-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background: var(--border); border-radius: 24px; overflow: hidden; border: 2px solid var(--border); }
.weekday { background: var(--panel); font-size: 13px; color: var(--gold); text-align: center; padding: 15px 0; font-weight: 900; text-transform: uppercase; }
.day { background: var(--day-bg); min-height: 90px; padding: 10px 5px; position: relative; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
.day.today { background: rgba(254, 245, 231, 0.2); box-shadow: inset 0 0 0 3px var(--gold); }
.day-num { font-weight: 900; font-size: 20px; margin-bottom: 5px; }
.symbols { display: flex; gap: 3px; width: 90%; height: 12px; justify-content: center; margin-top: auto; padding-bottom: 10px; }
.symbol-block { flex: 1; height: 100%; border-radius: 4px; max-width: 14px; }

/* GRAF S FIXN√çM √öHLEM */
.stats-section { margin-top: 30px; background: var(--panel); border-radius: 26px; padding: 20px 10px; border: 2px solid var(--border); overflow: hidden; }
.stats-bars { display: flex; align-items: flex-end; gap: 3px; height: 140px; margin-top: 15px; border-bottom: 2px solid var(--border); padding-bottom: 25px; justify-content: space-around; }
.bar-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 100%; position: relative; cursor: pointer; min-width: 0; }
.bar-count { font-size: 11px; font-weight: 900; color: var(--gold); margin-bottom: 4px; }
.bar-stack { width: 80%; display: flex; flex-direction: column-reverse; border-radius: 4px 4px 0 0; overflow: hidden; min-height: 3px; }
.segment { width: 100%; }
.bar-month-box { margin-top: 12px; font-size: 10px; font-weight: 800; color: var(--muted); transform: rotate(-45deg); transform-origin: top center; white-space: nowrap; }
.bar-container.active .bar-month-box { color: var(--gold); font-weight: 900; text-decoration: underline; }

.sync-zone { margin-top: 20px; display: flex; gap: 10px; }
.btn-sync { background: var(--border); color: var(--muted); border: 1px solid var(--muted); padding: 10px; border-radius: 10px; font-size: 12px; font-weight: bold; flex: 1; cursor: pointer; }

.year-month-card { background: var(--panel); padding: 20px; border-radius: 26px; border: 2px solid var(--border); margin-bottom: 25px; cursor: pointer; }
.year-event-list { margin-top: 15px; padding-top: 15px; border-top: 2px solid var(--border); font-size: 16px; line-height: 1.8; font-weight: 500; }
.modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 1000; display: none; align-items: flex-end; }
.modal-bg.show { display: flex; }
.modal { background: var(--panel); width: 100%; border-radius: 40px 40px 0 0; padding: 30px; box-sizing: border-box; border-top: 6px solid var(--gold); max-height: 92vh; overflow-y: auto; color: var(--text); }
.modal h3 { font-size: 26px; font-weight: 900; }
.modal input, .modal select { width: 100%; margin-bottom: 15px; padding: 18px; border-radius: 16px; background: var(--bg); border: 2px solid var(--border); color: var(--text); font-size: 18px; font-weight: bold; box-sizing: border-box; }
.btn-export { background: #4a90e2; color: white; border: none; padding: 14px; border-radius: 14px; font-weight: 800; font-size: 16px; margin-top: 8px; width: 100%; cursor: pointer; }
</style>
</head>
<body data-theme="dark">
<header>
  <div class="brand"><div class="title">FAMILY CALENDAR</div>
    <div style="display:flex; gap:12px;"><button class="theme-toggle" id="themeToggle">üåì</button><button class="btn-nav" id="todayBtn" style="background:var(--gold); color:#1c2e2e; border:none;">DNES</button></div>
  </div>
  <div class="view-switch"><button id="btnMonthView" class="active">MƒöS√çC</button><button id="btnYearView">ROK</button></div>
  <div class="person-search" id="personSearch"></div>
  <div class="controls" id="monthControls">
    <button class="btn-nav" id="prevMonth">‚óÄ</button><select id="monthSelect" class="select"></select><select id="yearSelect" class="select"></select><button class="btn-nav" id="nextMonth">‚ñ∂</button>
  </div>
</header>
<main class="main-content">
  <section id="monthSection" class="view-section active">
    <div id="monthLabel" class="month-label">‚Äî</div>
    <div class="agenda-section"><div class="agenda-title">Oslavy tento mƒõs√≠c:</div><div id="monthAgenda"></div></div>
    <div class="month-grid" id="mainGrid"></div>
    <div class="stats-section">
      <div class="agenda-title">Poƒçty ud√°lost√≠ v mƒõs√≠c√≠ch:</div>
      <div class="stats-bars" id="statsBars"></div>
      <div class="sync-zone">
        <button class="btn-sync" onclick="exportData()">üì§ EXPORTOVAT DATA</button>
        <button class="btn-sync" onclick="importData()">üì• IMPORTOVAT DATA</button>
      </div>
    </div>
  </section>
  <section id="yearSection" class="view-section"><div id="yearScrollList"></div></section>
</main>
<div class="modal-bg" id="modalBg" onclick="if(event.target===this) closeModal()">
  <div class="modal"><h3 id="modalTitle" style="color:var(--gold); margin-top:0;">Detail dne</h3><div id="eventList"></div>
    <div id="editForm"><input type="text" id="addName" placeholder="Jm√©no">
      <div style="display:flex; gap:12px;"><select id="addType" style="flex:2"><option value="bday">üéÇ Narozeniny</option><option value="nameday">üå∏ Sv√°tek</option><option value="anniv">üíç V√Ωroƒç√≠</option></select>
      <input type="number" id="addYear" placeholder="Rok narozen√≠" style="flex:1"></div>
      <button class="btn-nav" style="width:100%; padding:22px; background:var(--gold); color:#1c2e2e; border:none; border-radius:18px; font-weight:900; font-size:20px;" id="saveBtn">ULO≈ΩIT OSLAVU</button>
    </div><button onclick="closeModal()" style="width:100%; background:none; border:none; color:var(--muted); margin-top:25px; font-weight:900; font-size:18px;">ZAV≈ò√çT</button>
  </div>
</div>
<script>
if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
const months = ["Leden","√önor","B≈ôezen","Duben","Kvƒõten","ƒåerven","ƒåervenec","Srpen","Z√°≈ô√≠","≈ò√≠jen","Listopad","Prosinec"], shortMonths = ["Led","√öno","B≈ôe","Dub","Kvƒõ","ƒåer","ƒåvc","Srp","Z√°≈ô","≈ò√≠j","Lis","Pro"];
const cats = { bday: { c: 'var(--clr-bday)', i: 'üéÇ', t: 'Narozeniny' }, nameday: { c: 'var(--clr-nameday)', i: 'üå∏', t: 'Sv√°tek' }, anniv: { c: 'var(--clr-anniv)', i: 'üíç', t: 'V√Ωroƒç√≠' } };
const DB_KEY = 'fam_cal_v6_sync';
let curYear = new Date().getFullYear(), curMonth = new Date().getMonth(), events = JSON.parse(localStorage.getItem(DB_KEY) || '{}'), editKey = null;

document.getElementById('themeToggle').onclick = () => { const b = document.body; const nt = b.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'; b.setAttribute('data-theme', nt); localStorage.setItem('cal_theme_pref', nt); };
if(localStorage.getItem('cal_theme_pref') === 'light') document.body.setAttribute('data-theme', 'light');

function init() {
    months.forEach((m,i) => document.getElementById('monthSelect').innerHTML += `<option value="${i}">${m}</option>`);
    for(let y=2024; y<=2035; y++) document.getElementById('yearSelect').innerHTML += `<option value="${y}">${y}</option>`;
    document.getElementById('btnMonthView').onclick = () => switchView('month');
    document.getElementById('btnYearView').onclick = () => switchView('year');
    document.getElementById('prevMonth').onclick = () => { curMonth--; if(curMonth<0){curMonth=11; curYear--;} render(); };
    document.getElementById('nextMonth').onclick = () => { curMonth++; if(curMonth>11){curMonth=0; curYear++;} render(); };
    document.getElementById('monthSelect').onchange = (e) => { curMonth = parseInt(e.target.value); render(); };
    document.getElementById('yearSelect').onchange = (e) => { curYear = parseInt(e.target.value); render(); };
    document.getElementById('todayBtn').onclick = () => { const n=new Date(); curYear=n.getFullYear(); curMonth=n.getMonth(); render(); };
    document.getElementById('saveBtn').onclick = saveEvent;
    render();
}

function exportData() {
    const dataStr = btoa(unescape(encodeURIComponent(JSON.stringify(events))));
    navigator.clipboard.writeText(dataStr).then(() => alert("K√≥d dat byl zkop√≠rov√°n do schr√°nky! Po≈°li si ho do jin√©ho za≈ô√≠zen√≠ a tam dej Import."));
}

function importData() {
    const code = prompt("Vlo≈æte exportovan√Ω k√≥d dat:");
    if (code) {
        try {
            const decoded = JSON.parse(decodeURIComponent(escape(atob(code))));
            if (confirm("Importem p≈ôep√≠≈°ete v≈°echna st√°vaj√≠c√≠ data v tomto za≈ô√≠zen√≠. Pokraƒçovat?")) {
                events = decoded;
                localStorage.setItem(DB_KEY, JSON.stringify(events));
                render();
                alert("Data byla √∫spƒõ≈°nƒõ p≈ôesyp√°na!");
            }
        } catch(e) { alert("Chyba: Neplatn√Ω k√≥d dat."); }
    }
}

function switchView(v) { document.getElementById('btnMonthView').classList.toggle('active', v==='month'); document.getElementById('btnYearView').classList.toggle('active', v==='year'); document.getElementById('monthSection').classList.toggle('active', v==='month'); document.getElementById('yearSection').classList.toggle('active', v==='year'); }
function closeModal() { document.getElementById('modalBg').classList.remove('show'); }

function openDay(m, d) {
    editKey = `${m}-${d}`; document.getElementById('modalTitle').innerText = `${d}. ${months[m]} ${curYear}`; document.getElementById('editForm').style.display = "block";
    const list = document.getElementById('eventList'); list.innerHTML = "";
    (events[editKey] || []).forEach((ev, i) => { const age = (ev.type==='bday' && ev.y) ? ` (${curYear - ev.y} let)` : "";
        list.innerHTML += `<div class="ev-row" style="border-left-color:${cats[ev.type].c}; flex-direction:column; align-items:flex-start;">
            <div style="display:flex; width:100%; justify-content:space-between; align-items:center;"><span style="font-weight:900;">${cats[ev.type].i} ${ev.n}${age}</span><button onclick="delEv('${editKey}',${i})" style="color:#ff5252; background:none; border:none; font-weight:bold; font-size:28px;">√ó</button></div>
            <button class="btn-export" onclick="pushToGoogle('${ev.n}','${ev.type}',${d},${m})">üîî P≈òIDAT DO GOOGLE KALEND√Å≈òE</button></div>`;
    });
    document.getElementById('modalBg').classList.add('show');
}

function pushToGoogle(n, t, d, m) {
    const title = encodeURIComponent(`${cats[t].i} ${n}`);
    const dateStr = curYear + (m + 1).toString().padStart(2, '0') + d.toString().padStart(2, '0');
    const nextDay = new Date(curYear, m, d + 1);
    const dateEndStr = nextDay.getFullYear() + (nextDay.getMonth() + 1).toString().padStart(2, '0') + nextDay.getDate().toString().padStart(2, '0');
    const url = `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${dateStr}/${dateEndStr}&recur=RRULE:FREQ=YEARLY&details=P≈ôipom√≠nka z rodinn√© aplikace&sf=true&output=xml`;
    window.open(url, '_blank');
}

function saveEvent() {
    const n = document.getElementById('addName').value.trim(); if(!n) return;
    if(!events[editKey]) events[editKey] = []; events[editKey].push({ n, type: document.getElementById('addType').value, y: parseInt(document.getElementById('addYear').value) || null });
    localStorage.setItem(DB_KEY, JSON.stringify(events)); document.getElementById('addName').value = ""; document.getElementById('addYear').value = ""; render(); openDay(...editKey.split('-'));
}

function delEv(k, i) { if(confirm("Smazat?")) { events[k].splice(i,1); if(!events[k].length) delete events[k]; localStorage.setItem(DB_KEY, JSON.stringify(events)); render(); openDay(...k.split('-')); } }

function openPersonFilter(name) {
    document.getElementById('modalTitle').innerText = `Oslavy: ${name}`; document.getElementById('editForm').style.display = "none";
    const list = document.getElementById('eventList'); list.innerHTML = "";
    for (let k in events) { events[k].forEach(ev => { if(ev.n === name) { const [m, d] = k.split('-'); list.innerHTML += `<div class="ev-row" style="border-left-color:${cats[ev.type].c}"><strong>${d}. ${months[m]}</strong>: ${cats[ev.type].i} ${cats[ev.type].t}</div>`; } }); }
    document.getElementById('modalBg').classList.add('show');
}

function render() {
    document.getElementById('monthSelect').value = curMonth; document.getElementById('yearSelect').value = curYear; document.getElementById('monthLabel').innerText = `${months[curMonth]} ${curYear}`;
    const grid = document.getElementById('mainGrid'); grid.innerHTML = ""; ["Po","√öt","St","ƒåt","P√°","So","Ne"].forEach(w => grid.innerHTML += `<div class="weekday">${w}</div>`);
    const first = (new Date(curYear, curMonth, 1).getDay() || 7) - 1, days = new Date(curYear, curMonth + 1, 0).getDate();
    for(let i=0; i<first; i++) grid.innerHTML += `<div></div>`;
    let agendaHtml = ""; const names = new Set();
    for(let d=1; d<=days; d++) {
        const k = `${curMonth}-${d}`, evs = events[k] || [];
        const isToday = (d===new Date().getDate() && curMonth===new Date().getMonth() && curYear===new Date().getFullYear());
        let syms = ""; evs.forEach(ev => { syms += `<div class="symbol-block" style="background:${cats[ev.type].c}"></div>`; const age = (ev.type==='bday' && ev.y) ? ` (${curYear - ev.y} l.)` : ""; agendaHtml += `<div class="ev-row" style="border-left-color:${cats[ev.type].c}" onclick="openDay(${curMonth},${d})"><strong>${d}.</strong> ${cats[ev.type].i} ${ev.n}${age}</div>`; });
        grid.innerHTML += `<div class="day ${isToday?'today':''}" onclick="openDay(${curMonth},${d})"><div class="day-num">${d}</div><div class="symbols">${syms}</div></div>`;
    }
    document.getElementById('monthAgenda').innerHTML = agendaHtml || "<div style='color:var(--muted); padding:10px;'>≈Ω√°dn√© oslavy.</div>";
    
    const stats = Array.from({length:12}, () => ({total:0, b:0, n:0, a:0}));
    for(let k in events) { const m = parseInt(k.split('-')[0]); events[k].forEach(e => { stats[m].total++; stats[m][e.type==='bday'?'b':e.type==='nameday'?'n':'a']++; }); }
    const max = Math.max(...stats.map(s=>s.total)) || 1;
    document.getElementById('statsBars').innerHTML = stats.map((s,i) => `
        <div class="bar-container ${i===curMonth?'active':''}" onclick="curMonth=${i}; render();">
            <div class="bar-count">${s.total > 0 ? s.total : ''}</div>
            <div class="bar-stack" style="height:${(s.total/max)*85}%">
                <div class="segment" style="height:${(s.b/s.total)*100}%; background:var(--clr-bday)"></div>
                <div class="segment" style="height:${(s.n/s.total)*100}%; background:var(--clr-nameday)"></div>
                <div class="segment" style="height:${(s.a/s.total)*100}%; background:var(--clr-anniv)"></div>
            </div>
            <div class="bar-month-box">${shortMonths[i]}</div>
        </div>`).join('');

    for(let k in events) events[k].forEach(e => names.add(e.n));
    const searchDiv = document.getElementById('personSearch'); searchDiv.innerHTML = "";
    Array.from(names).sort().forEach(n => searchDiv.innerHTML += `<div class="person-box" onclick="openPersonFilter('${n}')">${n}</div>`);

    const yl = document.getElementById('yearScrollList'); yl.innerHTML = "";
    for(let m=0; m<12; m++) {
        let mg = ""; let mEvents = ""; const md = new Date(curYear, m+1, 0).getDate(), mf = (new Date(curYear, m, 1).getDay() || 7) - 1;
        for(let i=0; i<mf; i++) mg += `<div></div>`;
        for(let d=1; d<=md; d++) {
            const k = `${m}-${d}`, has = events[k];
            mg += `<div style="font-size:11px; padding:3px; ${has?`background:${cats[has[0].type].c}; color:#000; border-radius:4px; font-weight:bold;`:''}">${d}</div>`;
            if(has) has.forEach(e => { const age = (e.type==='bday' && e.y) ? ` (${curYear-e.y} let)` : ""; mEvents += `<div><b>${d}.</b> ${cats[e.type].i} ${e.n}${age}</div>`; });
        }
        yl.innerHTML += `<div class="year-month-card" onclick="curMonth=${m}; switchView('month'); render();">
            <div style="font-weight:900; color:var(--gold); font-size:22px; border-bottom:2px solid var(--border); padding-bottom:8px; margin-bottom:12px; display:flex; justify-content:space-between;"><span>${months[m]}</span><span style="opacity:0.5">${stats[m].total}x</span></div>
            <div style="display:grid; grid-template-columns:repeat(7,1fr); gap:3px; text-align:center; margin-bottom:15px;">${mg}</div>
            <div class="year-event-list">${mEvents || "<span style='opacity:0.3'>Pr√°zdno</span>"}</div>
        </div>`;
    }
}
init();
</script>
</body>
</html>
